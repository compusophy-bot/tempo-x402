name: E2E Tests

on:
  workflow_dispatch:
  workflow_run:
    workflows: ["Release"]
    types: [completed]

env:
  CARGO_TERM_COLOR: always

jobs:
  e2e:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    steps:
      - uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4
      - uses: dtolnay/rust-toolchain@stable
      - uses: Swatinem/rust-cache@779680da715d629ac1d338a641029a2f4372abb5 # v2
      - name: Run e2e tests
        env:
          EVM_PRIVATE_KEY: ${{ secrets.EVM_PRIVATE_KEY }}
          EVM_ADDRESS: ${{ secrets.EVM_ADDRESS }}
          FACILITATOR_URL: ${{ secrets.FACILITATOR_URL }}
          FACILITATOR_PRIVATE_KEY: ${{ secrets.FACILITATOR_PRIVATE_KEY }}
          FACILITATOR_ADDRESS: ${{ secrets.FACILITATOR_ADDRESS }}
        run: cargo test --workspace -- --ignored --nocapture
